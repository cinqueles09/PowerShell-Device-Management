name: Update README

on:
  push:
    paths:
      - 'Scripts/**'
  workflow_dispatch:

jobs:
  generate-readme:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Setup PowerShell
      uses: actions/setup-powershell@v2

    - name: Generate README.md
      shell: pwsh
      run: |
        $scriptsPath = "Scripts"
        $readmePath = "README.md"

        $readmeContent = @"
# Proyecto Scripts PowerShell

Este README se genera autom치ticamente y contiene la lista de scripts disponibles con sus descripciones.

| Script | Descripci칩n | Ejemplo |
|--------|-------------|--------|
"@

        $scripts = Get-ChildItem -Path $scriptsPath -Filter *.ps1
        foreach ($script in $scripts) {
            $content = Get-Content $script.FullName -Raw

            if ($content -match '\.SYNOPSIS\s*(.+?)\s*\.DESCRIPTION') {
                $synopsis = $matches[1].Trim()
            } else { $synopsis = "Sin descripci칩n" }

            if ($content -match '\.EXAMPLE\s*(.+?)\#>') {
                $example = $matches[1].Trim() -replace "`r`n", " "
            } else { $example = "" }

            $readmeContent += "| $($script.Name) | $synopsis | $example |`n"
        }

        Set-Content -Path $readmePath -Value $readmeContent

    - name: Commit README.md
      shell: pwsh
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add README.md
        git commit -m "Actualizar README autom치ticamente" || echo "No changes to commit"
        git push
